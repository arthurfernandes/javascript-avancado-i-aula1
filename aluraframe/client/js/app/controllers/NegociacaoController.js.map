{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","inputData","inputQuantidade","inputValor","_mensagem","Bind","Mensagem","MensagemView","_listaNegociacoes","ListaNegociacoes","NegociacoesView","_ordemAtual","_service","NegociacaoService","_init","self","lista","then","negociacoes","forEach","adiciona","negociacao","texto","catch","erro","recurse","setTimeout","importaNegociacoes","event","preventDefault","_criarNegociacao","e","carrega","mensagem","_","_limparFormulario","importa","apaga","esvazia","coluna","inverteOrdem","ordena","a","b","data","DateHelper","textoParaData","value","Negociacao","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\n\tconstructor() {\n\t\tlet $ = document.querySelector.bind(document);\n\n\t\tthis.inputData = $(\"#data\");\n\t\tthis.inputQuantidade = $(\"#quantidade\");\n\t\tthis.inputValor = $(\"#valor\");\n\n\t\tthis._mensagem = new Bind(\n\t\t\tnew Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto');\n\n\t\tthis._listaNegociacoes = new Bind(\n\t\t\tnew ListaNegociacoes(), new NegociacoesView($(\"#negociacoesView\")), \n\t\t\t\t'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\n\n\t\tthis._ordemAtual = '';\n\n\t\tthis._service = new NegociacaoService();\n\n\t\tthis._init();\n\t}\n\n\t_init() {\n\t\tlet self = this;\n\n\t\tthis._service.lista()\n\t\t\t.then(negociacoes => {\n\t\t\t\tnegociacoes.forEach( negociacao => this._listaNegociacoes.adiciona(negociacao))\n\t\t\t\tthis._mensagem.texto = \"Negociações resgatadas do banco com sucesso\";\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\n\t\t(function recurse(){\n\t\t\tsetTimeout(() => {\n\t\t\t\tself.importaNegociacoes();\n\t\t\t\trecurse();\n\t\t\t}, 4000);\n\t\t}());\n\t}\n\n\tadiciona(event){\n\t\tevent.preventDefault();\n\t\tlet negociacao;\n\t\ttry{\n\t\t\tnegociacao = this._criarNegociacao();\n\t\t}\n\t\tcatch(e) {\n\t\t\tthis._mensagem.texto = \"Não foi possível incluir a negociação, erro de formatação\";\n\t\t\treturn;\n\t\t}\n\n\t\tthis._service.carrega(negociacao)\n\t\t\t.then( mensagem => {\n\t\t\t\tthis._listaNegociacoes.adiciona(negociacao);\n\t\t\t\tthis._mensagem.texto = mensagem;\n\t\t\t\tthis._\n\t\t\t\tthis._limparFormulario();\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\timportaNegociacoes() {\n\n\t\tthis._service.importa(this._listaNegociacoes.negociacoes)\n\t\t\t.then( negociacoes => {\n\t\t\t\tnegociacoes.forEach( negociacao => this._listaNegociacoes.adiciona(negociacao));\n\t\t\t\tthis._mensagem.texto = \"Negociacoes importadas com Sucesso\";\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\tapaga() {\n\t\tthis._service.apaga()\n\t\t\t.then( mensagem => {\n\t\t\t\tthis._listaNegociacoes.esvazia();\n\t\t\t\tthis._mensagem.texto = mensagem;\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\tordena(coluna) {\n\t\tif (this._ordemAtual == coluna){\n\t\t\tthis._listaNegociacoes.inverteOrdem();\n\t\t}\n\t\telse{\n\t\t\tthis._listaNegociacoes.ordena( (a,b) => a[coluna] - b[coluna]);\n\t\t}\n\t\tthis._ordemAtual = coluna;\n\t}\n\n\t_criarNegociacao() {\n\t\tlet data = DateHelper.textoParaData(this.inputData.value);\n\n\t\treturn new Negociacao(\n\t\t\tdata,\n\t\t\tparseInt(this.inputQuantidade.value),\n\t\t\tparseFloat(this.inputValor.value)\n\t\t);\n\t}\n\n\t_limparFormulario() {\n\t\tthis.inputData.value = \"\";\n\t\tthis.inputQuantidade.value = 1;\n\t\tthis.inputValor.value = 0.0;\n\n\t\tthis.inputData.focus();\n\t}\n}"]}