{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","inputData","inputQuantidade","inputValor","_mensagem","_listaNegociacoes","_ordemAtual","_service","_init","self","lista","then","negociacoes","forEach","adiciona","negociacao","texto","catch","erro","recurse","setTimeout","importaNegociacoes","event","preventDefault","_criarNegociacao","e","carrega","mensagem","_","_limparFormulario","importa","apaga","esvazia","coluna","inverteOrdem","ordena","a","b","data","textoParaData","value","parseInt","parseFloat","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacoesView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {Bind} from '../helpers/Bind';\nimport {Negociacao} from '../models/Negociacao';\n\nclass NegociacaoController {\n\tconstructor() {\n\t\tlet $ = document.querySelector.bind(document);\n\n\t\tthis.inputData = $(\"#data\");\n\t\tthis.inputQuantidade = $(\"#quantidade\");\n\t\tthis.inputValor = $(\"#valor\");\n\n\t\tthis._mensagem = new Bind(\n\t\t\tnew Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto');\n\n\t\tthis._listaNegociacoes = new Bind(\n\t\t\tnew ListaNegociacoes(), new NegociacoesView($(\"#negociacoesView\")), \n\t\t\t\t'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\n\n\t\tthis._ordemAtual = '';\n\n\t\tthis._service = new NegociacaoService();\n\n\t\tthis._init();\n\t}\n\n\t_init() {\n\t\tlet self = this;\n\n\t\tthis._service.lista()\n\t\t\t.then(negociacoes => {\n\t\t\t\tnegociacoes.forEach( negociacao => this._listaNegociacoes.adiciona(negociacao))\n\t\t\t\tthis._mensagem.texto = \"Negociações resgatadas do banco com sucesso\";\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\n\t\t(function recurse(){\n\t\t\tsetTimeout(() => {\n\t\t\t\tself.importaNegociacoes();\n\t\t\t\trecurse();\n\t\t\t}, 4000);\n\t\t}());\n\t}\n\n\tadiciona(event){\n\t\tevent.preventDefault();\n\t\tlet negociacao;\n\t\ttry{\n\t\t\tnegociacao = this._criarNegociacao();\n\t\t}\n\t\tcatch(e) {\n\t\t\tthis._mensagem.texto = \"Não foi possível incluir a negociação, erro de formatação\";\n\t\t\treturn;\n\t\t}\n\n\t\tthis._service.carrega(negociacao)\n\t\t\t.then( mensagem => {\n\t\t\t\tthis._listaNegociacoes.adiciona(negociacao);\n\t\t\t\tthis._mensagem.texto = mensagem;\n\t\t\t\tthis._\n\t\t\t\tthis._limparFormulario();\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\timportaNegociacoes() {\n\n\t\tthis._service.importa(this._listaNegociacoes.negociacoes)\n\t\t\t.then( negociacoes => {\n\t\t\t\tnegociacoes.forEach( negociacao => this._listaNegociacoes.adiciona(negociacao));\n\t\t\t\tthis._mensagem.texto = \"Negociacoes importadas com Sucesso\";\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\tapaga() {\n\t\tthis._service.apaga()\n\t\t\t.then( mensagem => {\n\t\t\t\tthis._listaNegociacoes.esvazia();\n\t\t\t\tthis._mensagem.texto = mensagem;\n\t\t\t})\n\t\t\t.catch( erro => this._mensagem.texto = erro);\n\t}\n\n\tordena(coluna) {\n\t\tif (this._ordemAtual == coluna){\n\t\t\tthis._listaNegociacoes.inverteOrdem();\n\t\t}\n\t\telse{\n\t\t\tthis._listaNegociacoes.ordena( (a,b) => a[coluna] - b[coluna]);\n\t\t}\n\t\tthis._ordemAtual = coluna;\n\t}\n\n\t_criarNegociacao() {\n\t\tlet data = DateHelper.textoParaData(this.inputData.value);\n\n\t\treturn new Negociacao(\n\t\t\tdata,\n\t\t\tparseInt(this.inputQuantidade.value),\n\t\t\tparseFloat(this.inputValor.value)\n\t\t);\n\t}\n\n\t_limparFormulario() {\n\t\tthis.inputData.value = \"\";\n\t\tthis.inputQuantidade.value = 1;\n\t\tthis.inputValor.value = 0.0;\n\n\t\tthis.inputData.focus();\n\t}\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance() {\n\treturn negociacaoController;\n}"]}